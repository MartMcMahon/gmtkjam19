<!DOCTYPE html>
<html>
<meta charset=utf-8>
<title>Only One</title>
<style>
	html, body {
		margin: 0;
		border: 0;
		font-size: 16px;
	}
	.wrapper {
		width: 940px;
		padding: 10px;
		margin: 0 auto;
	}
	.gameboard {
		float: left;
		height:  480px;
		width: 480px;
	}
	.row {
		height: 10%;
		width: 100%;
		clear: both;
	}
	.boardcell {
		display: block;
		position: relative;
		float: left;
		background: green;
		height: 100%;
		width: 10%;
	}
	.boardentity {
		display: block;
		position: absolute;
		top: 10%; right: 10%; bottom: 10%; left: 10%;
		border-radius: 100%;
	}
	.controls {
		float: left;
		width: 440px;
		margin-left: 20px;
	}
	button {
		height: 40px;
		width: 100%;
		margin-bottom: 10px;
	}
</style>
<script>
	var board_size = [10, 10];
</script>
<body>
<div class="wrapper">
	<div class="gameboard">
		<script>
			for (var y=0; y<board_size[1];y++) {
				document.write("<div class='row'>");
				for (var x=0; x<board_size[0];x++) {
					document.write("<div class='boardcell' id='tile-" + x + "-" + y + "'><div class='boardentity' id='entity-" + x + "-" + y + "'></div></div>")
				}
				document.write("</div>");
			}
		</script>
	</div>
	<div class="controls">
		<div>Things Left</div>
		<h1>10</h1>
		<button onClick="decimate()">Decimate</button>
		<button>Plague (category decimate)</button>
		<button>Abiogenesis</button>
	</div>
</div>


<script type="text/javascript">
	// utilities ////////////////////////////////////////////////////////////
	function randint(min, max) {
		return Math.floor(min + (Math.random() * (max-min)))
	}
	function choose(list) {
		return list[randint(0, list.length)];
	}
	function shuffle(array) {
		for (var i = array.length - 1; i > 0; i--) {
			var j = Math.floor(Math.random() * (i + 1));
			var temp = array[i];
			array[i] = array[j];
			array[j] = temp;
		}
		return array;
	}


	// constants ////////////////////////////////////////////////////////////
	var board;
	var grass = { backgroundPosition: "0 0" };
	var water = { backgroundPosition: "-96px -96px" };
	var desert = {color: "yellow"};
	var forest = {color: "green"};

	var snake = {color: "red"};
	var mushroom = {color: "black"};
	var tree = {color: "brown"};

	var tiles = [
		grass, water// , desert, forest
	]
	var teams = [
		snake, mushroom, tree
	]


	// actions ////////////////////////////////////////////////////////////
	function find_occupied_cells(by_team) {
		var coords = [];
		for (var y=0; y<board_size[1];y++) {
			for (var x=0; x<board_size[0];x++) {
				var entity = board.teams[y][x];
				if (entity && (entity == by_team || by_team === undefined)) {
					coords.push([x, y]);
				}
			}
		}
		return coords;
	}
	function get_entity_count(of_team) {
		return find_occupied_cells(of_team).length;
	}
	function decimate(by_team) {
		var occupied = find_occupied_cells(by_team);
		occupied = shuffle(occupied);
		for (var i=Math.ceil(occupied.length / 10); i--;) {
			var coords = occupied[i];
			var x = coords[0];
			var y = coords[1];

			board.teams[y][x] = null;
		}
		render_board();
	}
	function spawn(by_team) {

	}

	function init_board() {
		board = {
			tiles: [],
			teams: []
		}
		for (var y=0; y<board_size[1];y++) {
			var row = [];
			for (var x=0; x<board_size[0];x++) {
				row.push(choose(tiles))
			}
			board.tiles.push(row);
		}
		for (var y=0; y<board_size[1];y++) {
			var row = [];
			for (var x=0; x<board_size[0];x++) {
				if (Math.random() > 0.7) {
					row.push(choose(teams))
				}
				else {
					row.push(null);
				}

			}
			board.teams.push(row);
		}
	}

	function render_cell(x, y, tile, team) {
		var tile_elem = document.getElementById('tile-' + x + '-' + y);
		var team_elem = document.getElementById('entity-' + x + '-' + y);

    tile_elem.style.backgroundImage = "url('./gfx/Overworld.png')";
    tile_elem.style.backgroundPosition = tile.backgroundPosition;
    tile_elem.style.backgroundSize = "1920px";

    team_elem.style.background = team ? team.color : 'transparent';
	}
	function render_board() {
		for (var y=0; y<board_size[1];y++) {
			for (var x=0; x<board_size[0];x++) {
				render_cell(x, y,
					board.tiles[y][x],
					board.teams[y][x]
				);
			}
		}
	}


	// Start the game
	init_board()
	render_board()
</script>
